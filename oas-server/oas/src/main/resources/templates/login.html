<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <title>web登陆系统 - 登录</title>
    <meta name="keywords" content="web登陆系统">
    
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/3.3.7/css/bootstrap.min.css}"/>
   
<!--       <link href="../static/css/style.css" th:href="@{css/style.css}" rel="stylesheet"/>    -->
    <link href="../static/css/login.css" th:href="@{css/login.css}" rel="stylesheet"/>
    <!-- 全局js -->
 <script th:src="@{/webjars/jquery/3.1.1/jquery.min.js}"></script>
  <script th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>
</head>

<body class="signin">

    <div class="signinpanel"> 
        <div class="row">
            <div class="col-sm-7">
                <div class="signin-info">
                    <div class="logopanel m-b">
                        <h1><img alt="[ 区块链 ]" src="../img/ball.571c6cc8.png" th:src="@{/img/ball.571c6cc8.png}"></h1>
                    </div>
                    <div class="m-b"></div>
                    <h4>欢迎使用 <strong>web 后台管理系统</strong></h4>
                    <ul class="m-b">
                        <li><i class="fa fa-arrow-circle-o-right m-r-xs"></i> SpringBoot</li>
                        <li><i class="fa fa-arrow-circle-o-right m-r-xs"></i> Mybatis</li>
                        <li><i class="fa fa-arrow-circle-o-right m-r-xs"></i> Shiro</li>
                        <li><i class="fa fa-arrow-circle-o-right m-r-xs"></i> Thymeleaf</li>
                        <li><i class="fa fa-arrow-circle-o-right m-r-xs"></i> Bootstrap</li>
                        <li><i class="fa fa-arrow-circle-o-right m-r-xs"></i> Jquery</li>
                    </ul>
                    <strong>还没有账号？ <a href="#">立即注册&raquo;</a></strong>
                </div>
            </div>
            <div class="col-sm-5">
                <form id="signupForm">
                    <h4 class="no-margins text-center">欢迎登录</h4>
<!--                    <p class="no-margins">登录：</p> -->
					<br/>
                    <input type="text" id="nameId" name="username" class="form-control uname" placeholder="用户名"/>
                    <input type="password" id="passwordId" name="password" class="form-control pword m-b" placeholder="密码"/>
					
					
					
					<!-- <label for="identifyCode" class="col-sm-3 control-label">验证码:</label> -->									 
					<!-- <div class="col-sm-8"> -->
						<input type="text" id="identifyCode" class="form-control checkinput" placeholder="验证码" onblur="checkIdentifyFirst()"/>
						<!-- <span id="msgFirst"></span>	 -->
						<br/>
					<!-- </div> -->
					<!-- <div class="col-sm-2"> -->
						<img style="margin-top: 3px" src="/api/v1/userCenter/getCode" id="CreateCheckCode" align="middle" class="checkcode"
						 onclick="this.src='/api/v1/userCenter/getCode?' + Math.random()"> 
						 <span id="msgFirst"></span>	
						<br/> 
					<!-- </div>					 -->
					
					



                    <button class="btn btn-primary btn-block" type="button" id="btnSubmit" onclick="submitLogin()">登录</button>
                     <br/>
                     <br/>
                </form>
            </div>
        </div>
        <div class="signup-footer">
            <div class="pull-left">
                &copy; 2018 All Rights Reserved. web区块链
            </div>
        </div>
    </div> 



</body>
<script>

	var check1 = 0;
	var check2 = 0;

	if (top != window)  
		top.location.href = window.location.href;  
	
	function submitLogin(){
		data={
			"name": $('#nameId').val(),
			"password": $('#passwordId').val(),
		};		
		var name=$('#nameId').val();

		$.ajax({
		type: 'post',
		url: '/api/v1/userCenter/login',
		data: JSON.stringify(data),
		contentType : 'application/json;charset=utf8',
		dataType: 'json',
		cache: false,
		success: function (res) {
			if (res.code == 0) {
				// var string=res.data.token;				
				//window.location.replace(encodeURI(encodeURI("/main?string="+string+"&用户名字="+name)));
				// window.location.replace("main")
				check1 = 1;
				return check1;
			} else {
				alert(res.message);
				check1 = 0;
				return check1;
			}
		},
		error: function (res) {
			alert(JSON.stringify(res));
		},
		complete: function () {
		}
		});
		}
	
	//检查log验证码正确与否
	function checkIdentifyFirst(){
		var identifyCode = $("#identifyCode").val();
	    var data = {
	      "identifyCode" : identifyCode
<<<<<<< HEAD
	    };	    
		//alert(JSON.stringify(data));
		
=======
	    };
	    
// 	    alert(JSON.stringify(data));
>>>>>>> 9ea25117ac97892a98405b0fca5d549edb5e6c03
	    $.ajax({
	      url : "/api/v1/userCenter/contrastCode",
		  data :JSON.stringify(data),
		  contentType : 'application/json;charset=utf8',
		  dataType: 'json',
		  type: 'post',
		  async : false,
		  cache: false,
	      success : function(res) {
			  if(res.msg=="null"){
				$("#msgFirst").html("请输入验证码");	          
				$("#msgFirst").css("color", "#ff0000");	
			  }
			  else{
				  if (res.code == 0) {
					$("#msgFirst").html("验证码正确！");
					$("#msgFirst").css("color", "#00ff00");
					check2 = 1;
					return check2;	          
				  } 
				  else {
						$("#msgFirst").html("验证码错误");	          
						$("#msgFirst").css("color", "#ff0000");	
						check2 = 0;
						return check2;         
					}
			  }			
		  },
	      error : function() {
		  	alert('检查验证码是否存在发生错误');
	      }
	    });
	  }

	  function login(){
		  if (check1 && check2 ) {
			  alert("success");
			  window.location.replace("main");
		  }
	  }

</script>
</html>
