<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>曲线显示</title>
        <style>
/*             .highcharts-axis-resizer {
    stroke: #eee;
}
.highcharts-axis-resizer:hover {
    stroke: #ccc;
} */
        </style>
        <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/3.3.7/css/bootstrap.min.css}"/>
         <!--<link rel="stylesheet" type="text/css" th:href="@{/webjars/highcharts/6.2.0/css/highstock.css}"/>-->
        <link rel="stylesheet" type="text/css" th:href="@{/webjars/highstock/6.0.3/css/highcharts.css}"/> 
        <!-- 全局js -->
        <script th:src="@{/webjars/jquery/3.1.1/jquery.min.js}"></script>
        <script th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>
        
        <script th:src="@{/webjars/highstock/6.0.3/js/highstock.js}"></script>
        <script th:src="@{/webjars/highcharts/6.2.0/js/highcharts.js}"></script>
    </head>
    <body>
        <div id="container" style="min-width:400px;height:400px"></div>
        <div id="container1" style="min-width:400px;height:400px"></div>
        <button type=button id="donymicLine" onclick="dynamicLine()">切换</button>
        <div id="container2" style="min-width:400px;height:400px"></div>
        <script>
        /* $.getJSON('https://data.jianshukeji.com/stock/history/000001', function (data) {
          if(data.code !== 1) {
            alert('读取股票数据失败！');
            return false;
          }
          data = data.data;
          // 去掉多余的数据
          Highcharts.each(data, function(d) {
            d.length = 2;
          });
          Highcharts.stockChart('container', {
            rangeSelector: {
              selected: 2
            },
            title: {
              text: '平安银行历史股价'
            },
            plotOptions: {
              series: {
                showInLegend: true
              }
            },
            tooltip: {
              split: false,
              shared: true
            },
            series: [{
              // type: 'line',
              id: '000001',
              name: '平安银行',
              data: data
            }]
          });
        }); */
        
      
       
//通过Ajax获取静态图表数据
var startTime='';
$(function(){
	var data1={};
    var x = [];//X轴
    var y = [];//Y轴
    var xtext = [];//X轴TEXT
	$.ajax({
		url: "/api/v1/load//selectLoadMsgForCurve",
	    contentType : 'application/json;charset=utf8',
	    dataType: 'json',
	    cache: false,
	    type: 'post',
	    data:JSON.stringify(data1),
	    async : false,
	    success: function(res) {
	    	alert(JSON.stringify(res));
	        var data2=res.data.rows;
	        var map={}
	        for (var i in data2){
	        	//alert(JSON.stringify(data2[i]));
	            var data3 = data2[i];
	            //alert(JSON.stringify(data3.minerName));
	            if(!map.hasOwnProperty(data3.minerName)){
	            	map[data3.minerName] = Array();
	            	}
	            var arr = map[data3.minerName];
	            arr.push(data3);
	            if(arr.length == 0){
	            	arr[0].y = Number(data3.minerDescription)
	     	        xtext.push(data3.updated);//给X轴TEXT赋值
	     	        }else{
	     	        	arr[arr.length-1].y = Number(data3.minerDescription)   //给Y轴赋值
	     	        	if(xtext[xtext.length-1]!=data3.updated){
	     	        		xtext.push(data3.updated);//给X轴TEXT赋值
	     	        		startTime=xtext[0];
	     	        		}
	     	        	}
	            } 
	        var chart1 = new Highcharts.Chart({
	        	chart: {
	        		renderTo: "container",
	                plotBackgroundColor: null,
	                plotBorderWidth: null,
	                plotShadow: false,
	                },
	                title: {
	                	text: '曲线图'
	                	},
	                	xAxis: {
	                		categories: xtext
	                		},
	                		yAxis: {                            //设置Y轴
	                			title: { 
	                				text: '温度值' 
	                				}
	                		},
	                		credits:{                          //右下角文本不显示
	                			enabled: false
	                			},
	                			tooltip: {
	                				pointFormat: '{series.name}: <b>{point.y}</b>'
	                				},
	                				plotOptions: {
	                					pie: {
	                						allowPointSelect: true,
	                						cursor: 'pointer',
	                						dataLabels: {
	                							enabled: true,
	                							format: '<b>{point.name}</b>: {point.percentage:.1f} %',
	                							style: {
	                								color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
	                								}
	                							},
	                							//showInLegend: true
	                							}
	                				},
	                				series: [{
	                					type: 'line',
	                					name: '温度值',
	                					//data:[1,2,3,4,5]
	                				},{
	                					type: 'line',
	                					name: '湿度值',
	                					//data:[1,2,3,4,5]
	                				},
	                				]
	                				});
	        //alert(map);
	        chart1.series[0].setData(map["温度"]);
	        chart1.series[1].setData(map["湿度"]);
	        // alert((chart1.series[0].data));
	        },
	        error: function(){
	        	alert("数据获取失败！")
	        	}
	        }); 
    })
        //动态显示曲线
        function dynamicLine(){
        	  var data1 = {
        	    "startTime" : startTime,
        	    "status":1
        	  };
            var x = [];//X轴
            var y = [];//Y轴
            var xtext = [];//X轴TEXT
        	$.ajax({
        		url: "/api/v1/load/selectLoadMsgByPeriod",
        	    contentType : 'application/json;charset=utf8',
        	    dataType: 'json',
        	    cache: false,
        	    type: 'post',
        	    data:JSON.stringify(data1),
        	    async : false,
        	    processData : false,
        	    success: function(res) {
        	    	alert(JSON.stringify(res));
        	        var data2=res.data.rows;
        	        var map={}
        	        for (var i in data2){
        	        	//alert(JSON.stringify(data2[i]));
        	            var data3 = data2[i];
        	            //alert(JSON.stringify(data3.minerName));
        	            if(!map.hasOwnProperty(data3.minerName)){
        	            	map[data3.minerName] = Array();
        	            	}
        	            var arr = map[data3.minerName];
        	            arr.push(data3);
        	            if(arr.length == 0){
        	            	arr[0].y = Number(data3.minerDescription)
        	     	        xtext.push(data3.updated);//给X轴TEXT赋值
        	     	        }else{
        	     	        	arr[arr.length-1].y = Number(data3.minerDescription)   //给Y轴赋值
        	     	        	if(xtext[xtext.length-1]!=data3.updated){
        	     	        		xtext.push(data3.updated);//给X轴TEXT赋值
        	     	        		startTime =data3.updated;
        	     	        		}
        	     	        	}
        	            } 
        	        var chart1 = new Highcharts.Chart({
        	        	chart: {
        	        		renderTo: "container1",
        	                plotBackgroundColor: null,
        	                plotBorderWidth: null,
        	                plotShadow: false,
        	                },
        	                title: {
        	                	text: '动态曲线图'
        	                	},
        	                xAxis: {
        	                	categories: xtext
        	                	},
        	                yAxis: {                            //设置Y轴
        	                	title: { 
        	                		text: 'Values' 
        	                		}
        	                },
        	                credits:{                          //右下角文本不显示
        	                	enabled: false
        	                		},
        	                tooltip: {
        	                	pointFormat: '{series.name}: <b>{point.y}</b>'
        	                	    },
        	                plotOptions: {
        	                	pie: {
        	                		allowPointSelect: true,
        	                		cursor: 'pointer',
        	                		dataLabels: {
        	                			enabled: true,
        	                			format: '<b>{point.name}</b>: {point.percentage:.1f} %',
        	                			style: {
        	                				color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
        	                				}
        	                			},
        	                			//showInLegend: true
        	                			}
        	                	   },
        	                series: [{
        	                	type: 'line',
        	                	name: '温度值',
        	                	//data:[1,2,3,4,5]
        	                       },{
        	                	type: 'line',
        	                	name: '湿度值',
        	                	//data:[1,2,3,4,5]
        	                	   },
        	                		]
        	                });
        	        //alert(map);
        	        chart1.series[0].setData(map["温度"]);
        	        chart1.series[1].setData(map["湿度"]);
        	        // alert((chart1.series[0].data));
        	        },
        	        error: function(){
        	        	alert("数据获取失败！")
        	        	}
        	        }); 
        }

//function realTimeLine(){
$(function(){	
	/* var data1={};
    var x = [];//X轴
    var y = [];//Y轴
    var xtext = [];//X轴TEXT
	$.ajax({
		url: "/api/v1/load//selectLoadMsgForCurve",
	    contentType : 'application/json;charset=utf8',
	    dataType: 'json',
	    cache: false,
	    type: 'post',
	    data:JSON.stringify(data1),
	    async : false,
	    success: function(res) {
	    	alert(JSON.stringify(res));
	        var data2=res.data.rows;
	        var map={}
	        for (var i in data2){
	        	//alert(JSON.stringify(data2[i]));
	            var data3 = data2[i];
	            //alert(JSON.stringify(data3.minerName));
	            if(!map.hasOwnProperty(data3.minerName)){
	            	map[data3.minerName] = Array();
	            	}
	            var arr = map[data3.minerName];
	            arr.push(data3);
	            if(arr.length == 0){
	            	arr[0].y = Number(data3.minerDescription)
	     	        xtext.push(data3.updated);//给X轴TEXT赋值
	     	        }else{
	     	        	arr[arr.length-1].y = Number(data3.minerDescription)   //给Y轴赋值
	     	        	if(xtext[xtext.length-1]!=data3.updated){
	     	        		xtext.push(data3.updated);//给X轴TEXT赋值
	     	        		}
	     	        	}
	            } 
	        },
	        error: function(){
	        	alert("数据获取失败！")
	        	}
	        }); */ 
	
	Highcharts.setOptions({
		global: {
				useUTC: false
		}
});
function activeLastPointToolip(chart) {
		var points = chart.series[0].points;
		chart.tooltip.refresh(points[points.length -1]);
}
var chart = Highcharts.chart('container2', {
		chart: {
				type: 'spline',
				marginRight: 10,
				events: {
						load: function () {
								var series = this.series[0],
										chart = this;
								activeLastPointToolip(chart);
								setInterval(function () {
										var x = (new Date()).getTime(), // 当前时间
										y = Math.random();          // 随机值
										series.addPoint([x, y], true, true);
										activeLastPointToolip(chart);
								}, 1000);
						}
				}
		},
		title: {
				text: '动态模拟实时数据'
		},
		xAxis: {
				//type: 'datetime',
				tickPixelInterval: 150
		},
		yAxis: {
				title: {
						text: null
				}
		},
		tooltip: {
				formatter: function () {
						return '<b>' + this.series.name + '</b><br/>' +
								Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
								Highcharts.numberFormat(this.y, 2);
				}
		},
		legend: {
				enabled: false
		},
		series: [{
				name: '随机数据',
				data: (function () {
						// 生成随机值
						var data = [],
								time = (new Date()).getTime(),
								i;
						for (i = -19; i <= 0; i += 1) {
								data.push({
										x: time + i * 1000,
										y: Math.random()
								});
						}
						return data;
				}())
		}]
});
//}  
});
        
        
 
        </script>
    </body>
</html>