
<!DOCTYPE html >
<html xmlns:th="http://www.thymeleaf.org">
<head>
 <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>JS切换图片（页面中可重复使用）</title>
<!-- <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/3.3.7/css/bootstrap.min.css}"/> -->
 <script src="/js/wbsocket.js"></script>

 <script th:src="@{/webjars/jquery/3.1.1/jquery.min.js}"></script>
  <script th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>
<!--   <script src="/js/video/video.js" type="text/javascript"></script> -->
<style type="text/css"> 
* { margin:0; padding:0; }
/* body { background:#FFF; color:#333; font:12px/1.6em Helvetica, Arial, sans-serif; } */
h1, h2, h3, h4, h5, h6 { font-size:1em; }
a { color:#0287CA; text-decoration:none; }
a:hover { text-decoration:underline; }
ul, li { list-style:none; }
fieldset, img { border:none; }
legend { display:none; }
em, strong, cite, th { font-style:normal; font-weight:normal; }
 input, textarea, select, button { font:12px Helvetica, Arial, sans-serif; } 
table { border-collapse:collapse; }
/* html { overflow:-moz-scrollbars-vertical; }  */
.ibanner { position:relative; overflow:hidden; margin:20px 0 20px 300px; }
.ibanner_pic {}
.ibanner_pic a { position:absolute; top:0; display:block;  overflow:hidden; }
.ibanner_btn { position:absolute; z-index:9999; right:5px; bottom:5px; font-weight:700; font-family:Arial; }
.ibanner_btn span { display:block; float:left; margin-left:4px; padding:0 5px; background:#000; cursor:pointer; }
.ibanner_btn .normal { height:20px; margin-top:8px; border:1px solid #999; color:#999; font-size:16px; line-height:20px; }
.ibanner_btn .current { height:28px; border:1px solid #FF5300; color:#FF5300; font-size:28px; line-height:28px; }


 /* 进度条 */  
.range {   
    width: 430px;   
     height: 1rem;    
/*         background: #2386e4;    */
background: -webkit-linear-gradient(#61bd12, #61bd12) no-repeat, #ddd;
    border-radius: 0.5rem;   
    -webkit-appearance: none !important;   
    position: absolute;   
/*     top: 3.55rem;    */
/*     left: 6rem;   */
     left:470px  ;
     background-size: 0% 100%;
    
}   
/* 进度滑块 */  
.range::-webkit-slider-thumb {   
    width: 1.25rem;   
    height: 1.25rem;   
    background: #fff;   
    border: 1px solid #f18900;   
    cursor: pointer;   
    border-radius: 1.25rem;   
     -webkit-appearance: none !important;    
}  
/*  cursor: pointer; 鼠标变成手型,-webkit-appearance: none !important;将原来样式去除*/
  .col-center-block {
  position: relative;

/*      width: 768px;  */
 

/*       display: block;   */

    margin-left: auto;

    margin-right: auto;
    vertical-align: middle;
    margin-top: 30px;

}
 .btn{
/*   display: none; */
cursor: pointer;
  width: 15px;
  height: 15px;
  border-radius: 50%;
  position: absolute;
  left: 30%;
  top: 50%;
  margin: -15px auto  auto -35px;
  padding: 15px;
  background: rgba(255,255,255,0.5);
/*   rgba(255,255,255,0.5);灰色 */
  line-height: 40px;
  border: 1px solid #f18900;  
}
.ibanner .btn:hover{
  background: rgba(255,255,255,0.7);
}
 .btn:before{
  border: 15px solid #2386e4;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-right-color: transparent;
  content: " ";
  display: block;
  margin-left: 2px;
  width: 0;
  height: 0;
  margin-top: -7px;
}

.btn2:before{
    border-color: #2386e4;
    border-style: solid;
    content: " ";
    border-width: 12px 2px 10px 5px;
    content: " ";
    display: block;
    margin-left: -2px;
    width: 0;
    height: 0;
    margin-top: -3px;
}
.btn2:after{
    border-color: #2386e4;
    border-style: solid;
    content: " ";
    border-width: 12px 2px 10px 5px;
    content: " ";
    display: block;
    margin-left: 10px;
    width: 0;
    height: 0;
    margin-top: -22px;
}

.ibanner .btn:before:hover{
  border-left-color: #fff;
}

.ibanner.pause .btn{
  display: block;
}

.ibanner .state{
  position: absolute;
  bottom: 20px;
  left: 40px;
  font-size: 14px;
  color: #000;
}
.ibanner.pause .state{
  display: none;
}
.btnleft{
/*   display: none; */
  width: 5px;
  height: 5px;
  border-radius: 50%;
  position: absolute;
  left: 26%;
  top: 50%;
  margin: -10px auto  auto -35px;
  padding: 15px;
  background: rgba(255,255,255,0.5);
  line-height: 40px;
  border: 1px solid #f18900;  
}
.btnleft:before{
  border: 10px solid #2386e4;
  border-top-color: transparent;

  border-bottom-color: transparent;
  border-left-color: transparent;
  content: " ";
  display: block;
  margin-left: -20px;
  width: 0;
  height: 0;
  margin-top: -7px;
}
.btnleft:after{
  border: 10px solid #2386e4;
  border-top-color: transparent;

  border-bottom-color: transparent;
  border-left-color: transparent;
  content: " ";
  display: block;
  margin-left: -10px;
  width: 0;
  height: 0;
  margin-top: -20px;
}
.btnright{
/*   display: none; */
  width: 5px;
  height: 5px;
  border-radius: 50%;
  position: absolute;
  left: 34.8%;
  top: 50%;
  margin: -10px auto  auto -35px;
  padding: 15px;
  background: rgba(255,255,255,0.5);
  line-height: 40px;
  border: 1px solid #f18900;  
}
.btnright:before{
  border: 10px solid #2386e4;
  border-top-color: transparent;

  border-bottom-color: transparent;
  border-right-color: transparent;
  content: " ";
  display: block;
  margin-left: 5px;
  width: 0;
  height: 0;
  margin-top: -7px;
}
.btnright:after{
  border: 10px solid #2386e4;
  border-top-color: transparent;

  border-bottom-color: transparent;
  border-right-color: transparent;
  content: " ";
  display: block;
  margin-left: -5px;
  width: 0;
  height: 0;
  margin-top: -20px;
}
.time{
position: absolute;
 width: auto;
  height: auto;
  margin-left: 910px;
  margin-top: -0px;
}
.real{
position: absolute;
 width: auto;
  height: auto;
  margin-left: 970px;
  margin-top: -0px;
}
</style>

</head>
<body>
<div class="ibanner" style="width:650px; height:250px;" id="ibanner1">
<div class="ibanner_pic" id="ibanner_pic1">
<a href="#"><img style="width:650px; height:250px;" src="" alt="" /></a>
<!-- <a href="/jscss/"><img style="width:650px; height:250px;" src="" alt="" /></a> -->
<!-- <a href="/jscss/"><img style="width:650px; height:250px;" src="" alt="" /></a> -->
<!-- <a href="/jscss/"><img style="width:650px; height:250px;" src="" alt="" /></a> -->

</div>

</div>
<div  class="col-center-block">
<!-- <span class='cur'></span> -->
<em class="btnleft "style="display:inline-block"></em>
 <em id="buttonPlay" class="btn "style="display:inline-block" ></em>
 <em class="btnright "style="display:inline-block" ></em>
<input type="range" style="display:inline-block" id="range_speed" min="0" max="100" class='range' value="0"oninput="changeSpeed()" />
<input type="button"style="display:inline-block" value='00:00:00' id="timeb" class="time" /> 
<input type="button"style="display:inline-block" value='订阅' id="real" class="real" onclick="real()" /> 
</div>
<br/>
<!-- <div style="height:20px; background:#EEE;"></div> -->

 
<!-- <div class="ibanner" style="width:350px; height:125px;" id="ibanner2"> -->
<!-- <div class="ibanner_pic" id="ibanner_pic2"> -->
<!-- <a href="/jscss/"><img style="width:350px; height:125px;" src="http://p1.mb5u.com/texiao/1/20110225160443156.jpg" alt="" /></a> -->
<!-- <a href="/jscss/"><img style="width:350px; height:125px;" src="http://p1.mb5u.com/texiao/1/20110225160443157.jpg" alt="" /></a> -->
<!-- <a href="/jscss/"><img style="width:350px; height:125px;" src="http://p1.mb5u.com/texiao/1/20110225160443158.jpg" alt="" /></a> -->
<!-- <a href="/jscss/"><img style="width:350px; height:125px;" src="http://p1.mb5u.com/texiao/1/20110225160443159.jpg" alt="" /></a> -->
<!-- <a href="/jscss/"><img style="width:350px; height:125px;" src="http://p1.mb5u.com/texiao/1/20110225160443157.jpg" alt="" /></a> -->
<!-- </div> -->
<!-- </div> -->
 
 <script type="text/javascript">
 var event='';
 var btn = document.querySelector('.btn')
 btn.addEventListener('click', function () {
	 console.log(event)
	  if (!event) {
		   
		  if($('#range_speed').val()==$('#range_speed').attr("max")){
			  init(); 
			  
		  }
		  
		  //clearInterval(event);
		  event=setInterval('autoBanner("1","1")', 2000);
		  $('#buttonPlay').addClass('btn2');
	  } else {
		  console.log("bujin")
		  $('#buttonPlay').removeClass('btn2');
		  clearInterval(event);
		  event="";
	  }
	})
	  
    function bannerInit() {
        addBtn('1');
        iBanner('1');
 
    }
 function changeSpeed() {
		 var value = $('#range_speed').val();
		var sum=$("#range_speed").attr("max")
		console.log(value)
		var valStr = value/sum*100 + "% 100%";
		$('#value1').html((value / 10).toFixed(1));
		$('#range_speed').css({
		  "background-size": valStr
		}) 
		//$("input[name='animat_speed']").val((value / 10).toFixed(1));
 }
function changeThumb(time){
	
	var value=time;
	//var sum=$("#timeb").val();
	var sum=$("#range_speed").attr("max")
	
	var valStr = value / sum * 100 + "% 100%";
	console.log(valStr)

	$('#value1').html((value / 10).toFixed(1));
	$('#range_speed').css({
	  "background-size": valStr
	})
	
	$('#range_speed').val(value);
}

 //将秒数转为00:00格式   
 function timeToStr(time) {   
     var m = 0,   
     s = 0,   
     _m = '00',   
     _s = '00';   
    time = Math.floor(time % 3600);   
     m = Math.floor(time / 60);   
     s = Math.floor(time % 60);   
     _s = s < 10 ? '0' + s : s + '';   
     _m = m < 10 ? '0' + m : m + '';   
     return _m + ":" + _s;   
 }   
 //触发播放事件   
 $('.play').on('click',function(){   
     var audio=document.getElementById('ao');   
     audio.play();   
     setInterval(function(){   
         var t=parseInt(audio.currentTime);   
     $(".range").attr({'max':751});   
     $('.max').html(timeToStr(751));   
         $(".range").val(t);   
     $('.cur').text(timeToStr(t));   
     },1000);   
 });   
 //监听滑块，可以拖动   
 $(".range").on('change',function(){   
     //document.getElementById('ao').currentTime=this.value;
     $(".range").val(this.value);   
 });  


 
 
 var time=0;
var photo=[];
var startTime;
var startTimeback;
var endTime;
$(function(){
	bannerInit()
	init();
	  });
function init(){
	var data={};
$.ajax({

   type: 'post',
   url: '/api/v1/load/selectLoadMsg',
   data: JSON.stringify(data),
   contentType : 'application/json;charset=utf8',
   dataType: 'json',
   cache: false,
   async:false,
   success: function (res) {
     if (res.code == 0) {
    	startTime=res.data.startTime;
    	endTime=res.data.endTime;
    	startTimeback=res.data.startTime;
    	
    	//$("#range_speed").max=res.data.totalOfLast*2;
    	$('#range_speed').val(0);
    	time=0;
    	changeThumb(0);
    	 $(".range").attr({'max':(res.data.totalOfLast-1)*2});   
    	$("#timeb").val(changeTime((res.data.totalOfLast-1)*2));
    	var row=res.data.rows;
    	
    	 for(var i=0;i<row.length;i++)
    	{ 
    		 console.log("tupian",row[i].loadPicturePath)
    		 if(row[i].loadPicturePath.substr(row[i].loadPicturePath.length-4)=="null")
    		 	{ row.splice(i,1);
    		 		i--;
    		 	}else{
    		 	photo.push(row[i].loadPicturePath)
    		 	}
    		
    	}
     } else {
    	 	alert(res.message);
     		}
   },
   error: function (res) {
	  alert("11"+JSON.stringify(res));
   },
   complete: function () {
   }
  });
var phoList = getEvent('ibanner_pic' + 1).getElementsByTagName('img');
 for (var i = 0; i < phoList.length; i++) {
     phoList[i].src = photo[i]
     console.log("lujin",phoList[i].src)
        
     
 }
}  
    function getEvent(id) {
    	
        return document.getElementById(id);
    }
    function addLoadEvent(func) {
        var oldonload = window.onload;
        if (typeof window.onload != 'function') {
            window.onload = func;
        }
        else {
            window.onload = function () {//文档加载完处理
                oldonload();
                func();
            }
        }
    }
    function addBtn(ibannerIndex) {
        if (!getEvent('ibanner' + ibannerIndex) || !getEvent('ibanner_pic' + ibannerIndex)) {
            return;
        }
        var picList = getEvent('ibanner_pic' + ibannerIndex).getElementsByTagName('a');
        if (picList.length == 0) {
            return;
        }
        var btnBox = document.createElement('div');
        btnBox.setAttribute('id', 'ibanner_btn' + ibannerIndex);
        btnBox.setAttribute('class', 'ibanner_btn');
        var SpanBox = '';
        for (var i = 1; i <= picList.length; i++) {
            var spanList = '<span class="normal">' + i + '</span>';
            SpanBox += spanList;
        }
        btnBox.innerHTML = SpanBox;
        getEvent('ibanner' + ibannerIndex).appendChild(btnBox);
        getEvent('ibanner_btn' + ibannerIndex).getElementsByTagName('span')[0].className = 'current';
        for (var m = 0; m < picList.length; m++) {
            var attributeValue = 'picLi_' + ibannerIndex + m;
            picList[m].setAttribute('id', attributeValue);
        }
    }
    function moveElement(elementID, final_x, final_y, interval) {
        if (!document.getElementById) {
        	
            return false;
        }
        if (!document.getElementById(elementID)) {
        	
            return false;
        }
        var elem = document.getElementById(elementID);
        if (elem.movement) {//先判断是否在运动，先结束上次运行的这段函数
        	
            clearTimeout(elem.movement);//clearTimeout() 方法可取消由 setTimeout() 方法设置的 timeout。
        }
        if (!elem.style.left) {
            elem.style.left = "0px";
        }
        if (!elem.style.top) {
            elem.style.top = "0px";
        }
        var xpos = parseInt(elem.style.left);
        var ypos = parseInt(elem.style.top);
        if (xpos == final_x && ypos == final_y) {
        	console.log(222)
            moveing = false;
            return true;
        }
        if (xpos < final_x) {
            var dist = Math.ceil((final_x - xpos) / 10);//每运动一次的数值，返回大于等于参数x的最小整数,即对浮点数向上取整
            xpos = xpos + dist;
        }
        if (xpos > final_x) {
            var dist = Math.ceil((xpos - final_x) / 10);
            xpos = xpos - dist;
        }
        if (ypos < final_y) {
            var dist = Math.ceil((final_y - ypos) / 10);
            ypos = ypos + dist;
        }
        if (ypos > final_y) {
            var dist = Math.ceil((ypos - final_y) / 10);
            ypos = ypos - dist; 
        }
        elem.style.left = xpos + "px";
        elem.style.top = ypos + "px";
       
        var repeat = "moveElement('" + elementID + "'," + final_x + "," + final_y + "," + interval + ")";
        elem.movement = setTimeout(repeat, interval);//再次运行
    }
    function classNormal(ibannerIndex) {
        var btnList = getEvent('ibanner_btn' + ibannerIndex).getElementsByTagName('span');
        for (var i = 0; i < btnList.length; i++) {
            btnList[i].className = 'normal';
        }
    }
    function picZ(ibannerIndex) {
        var picList = getEvent('ibanner_pic' + ibannerIndex).getElementsByTagName('a');
        for (var i = 0; i < picList.length; i++) {
            picList[i].style.zIndex = '1';
        }
    }
    var autoKey = false;
    function iBanner(ibannerIndex) {
        if (!getEvent('ibanner' + ibannerIndex) || !getEvent('ibanner_pic' + ibannerIndex) || !getEvent('ibanner_btn' + ibannerIndex)) {
            return;
        }
        getEvent('ibanner' + ibannerIndex).onmouseover = function () {//鼠标移动到图片执行代码
            autoKey = true;
        };
        getEvent('ibanner' + ibannerIndex).onmouseout = function () {//鼠标移出图片执行代码
            autoKey = false;
        };
        var btnList = getEvent('ibanner_btn' + ibannerIndex).getElementsByTagName('span');
        var picList = getEvent('ibanner_pic' + ibannerIndex).getElementsByTagName('a');
        if (picList.length == 1) {
            return;
        }
        picList[0].style.zIndex = '2';
        for (var m = 0; m < btnList.length; m++) {
            btnList[m].onmouseover = function () {
                for (var n = 0; n < btnList.length; n++) {
                    if (btnList[n].className == 'current') {
                        var currentNum = n;
                    }
                }
                classNormal(ibannerIndex);
                picZ(ibannerIndex);
                console.log("1",this)
                this.className = 'current';
                picList[currentNum].style.zIndex = '2';
                var z = this.childNodes[0].nodeValue - 1;
                picList[z].style.zIndex = '3';
                if (currentNum != z) {
                    picList[z].style.left = '650px';
                    moveElement('picLi_' + ibannerIndex + z, 0, 0, 10);
                }
            }
        }
    }
 
    function autoBanner(ibannerIndex,ids) {
        if (!getEvent('ibanner' + ibannerIndex) || !getEvent('ibanner_pic' + ibannerIndex)|| !getEvent('ibanner_btn' + ibannerIndex)|| autoKey  ) {
            return;
        }
    	time=parseInt(time)+2;
    	
        changeThumb(time)
        //changeSpeed();
        var btnList = getEvent('ibanner_btn' + ibannerIndex).getElementsByTagName('span');
        var picList = getEvent('ibanner_pic' + ibannerIndex).getElementsByTagName('a');
        var phoList = getEvent('ibanner_pic' + ibannerIndex).getElementsByTagName('img');
        
        
        //ajax
        //var photo=[];
       // console.log(picList1)
       photo.splice(0, 1);
       console.log("photo.length",photo.length)
       
      if(ids=="1")
     	{
    	  
		    	  var date1 = new Date(startTimeback)
		       startTimeback=increateTime(false,date1)
		       console.log("starttime",startTime)
		       console.log("startTimeback",startTimeback)
		       var data={"time":startTimeback};
				$.ajax({
				
			   type: 'post',
			   url: '/api/v1/load/selectLoadMsgByTime',
			   data: JSON.stringify(data),
			   contentType : 'application/json;charset=utf8',
			   dataType: 'json',
			   cache: false,
			   async:true,
			   success: function (res) {
			     if (res.code == 0) {
			    	var row=res.data.rows
			    	
			    	 for(var i=0;i<row.length;i++)
			    	{ 	
			    		 if(row[i].loadPicturePath.substr(row[i].loadPicturePath.length-4)=="null")
				 			{ 
			    			 row.splice(i,1);
			 					i--;
			 				}else{
			 					console.log("photo1",row[i].loadPicturePath)
			 					photo.push(row[i].loadPicturePath)
			 					}
			    	}
			    	 
			     } else {
			    	 alert(res.message);
			     }
			   },
			   error: function (res) {
				  alert("11"+JSON.stringify(res));
			   },
			   complete: function () {
			   }
			  });
     	}
		if(photo.length==0){
    		//alert("数据已播完")
    		 $('#buttonPlay').removeClass('btn2');
    		clearInterval(event);
    		clearInterval(eventReal);
    		event="";
    		eventReal="";
    		//var date1 = new Date(startTime)
    		startTimeback=0;
    			//reduceTime(false,date1,1);
    		return;
    	}
        for (var i = 0; i < phoList.length; i++) {
        	
        	
            phoList[i].src = photo[i]
            console.log("lujin",phoList[i].src)
              
            
        }
        if (picList.length == 1) {
            //return;
        }
        for (var i = 0; i < btnList.length; i++) {
            if (btnList[i].className == 'current') {
                var currentNum = i;
            }
        }
        if (currentNum == (picList.length - 1)) {
            classNormal(ibannerIndex);
            picZ(ibannerIndex);
            btnList[0].className = 'current';
            picList[currentNum].style.zIndex = '2';
            picList[0].style.zIndex = '3';
            picList[0].style.left = '650px';
            moveElement('picLi_' + ibannerIndex + '0', 0, 0, 10);
        }
        else {
            classNormal(ibannerIndex);
            picZ(ibannerIndex);
            var nextNum = currentNum + 1;
            btnList[nextNum].className = 'current';
            picList[currentNum].style.zIndex = '2';
            picList[nextNum].style.zIndex = '3';
            picList[nextNum].style.left = '650px';
            moveElement('picLi_' + ibannerIndex + nextNum, 0, 0, 10);
        }
    }
    function changeTime(time){
		
		var newTime = parseInt(time);
		var hour = toZero(Math.floor(newTime/3600));//Math.floor返回小于等于x的最大整数:
		var min = toZero(Math.floor(newTime%3600/60));
		var sec = toZero(Math.floor(newTime%60));
		return hour+":"+min+":"+sec;
		function toZero(num){
			if(num<10){
				return '0'+num;
			} else{
				return num;
			}
		}
	}
    function reduceTime(flag,t,seconds)
    {//var t = new Date();//你已知的时间
        var t_s = t.getTime();//转化为时间戳毫秒数
        t.setTime(t_s - 1000 * seconds);
        //t.setTime(t.setHours(t.getHours() -8));
        var time=generateTime(flag,t)
        return time}
    function increateTime(flag,t) {
        //var t = new Date();//你已知的时间
        var t_s = t.getTime();//转化为时间戳毫秒数
        t.setTime(t_s + 1000 * 1);
        //t.setTime(t.setHours(t.getHours() -8));
        var time=generateTime(flag,t)
        return time
         
}
    function generateTime(flag,now){
        var year = now.getFullYear();       //年
        var month = now.getMonth() + 1;     //月
        var day = now.getDate();            //日
       
        var hh = now.getHours();            //时
        var mm = now.getMinutes();          //分
        var ss=now.getSeconds();
        if(flag){
         //var clock = JSON.stringify(year);
        var clock = year + "-";
          
              if(month < 10)
                clock += "0";
          
            clock += month + "-";
          
              if(day < 10)
                clock += "0";
              
            clock += day;
                  return (clock)
                }
        else{
          clock = year + "-";
       
        if(month < 10)
            clock += "0";
       
        clock += month + "-";
       
        if(day < 10)
            clock += "0";
           
        clock += day + " ";
       
        if(hh < 10)
            clock += "0";
           
        clock += hh + ":";
        if (mm < 10) clock += '0'; 
        clock += mm+":"; 
         if (ss < 10) clock += '0'; 
        clock += ss; 
        return(clock); 
        }
    }
   // var photoReal;
    var eventReal;
    function real(){
    	 if(!eventReal){
    		 event="";
    		 photo=[];
    	connect(undefined,function(msg){
    		console.log(msg);
    		msg = JSON.parse(msg)
    		
    		for(var i=0;i<msg.length;i++)
    		{
    			photo.push(msg[i].loadPicturePath)
    		}
    		$(".range").attr({'max':photo.length*2});   
        	$("#timeb").val(changeTime(photo.length*2));
    	},"topic");
    	if(photo.length==0){
    		setTimeout(function(){
    		$('#range_speed').val(0);
        	time=0;
        	changeThumb(0);
        
        	eventReal=setInterval('autoBanner("1","2")', 2000);},1000)
    	}else{
    		$('#range_speed').val(0);
        	time=0;
        	changeThumb(0);
        	
        	eventReal=setInterval('autoBanner("1","2")', 2000);
    	}
    	
    }
    }
   
  
    
</script>
</body>
</html>
