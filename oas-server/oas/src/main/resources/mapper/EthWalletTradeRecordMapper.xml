<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cascv.oas.server.blockchain.mapper.EthWalletTradeRecordMapper">

  <resultMap id="ethWalletTradeRecordMap" type="com.cascv.oas.server.blockchain.wrapper.EthWalletTradeRecordInfo">
	<result column="name" property="name"/>
	<result column="value" property="value"/>
	<result column="title" property="title"/>
	<result column="sub_title" property="subTitle"/>
	<result column="created" property="created"/>
	<result column="remark" property="remark"/>
	<result column="rest_balance" property="restBalance"/>
  </resultMap>

<select id="selectAllTradeRecordBySearchValue" resultMap="ethWalletTradeRecordMap">
  select 
	u.name,ed.value,ed.title,ed.created,ed.remark,ed.rest_balance,ed.sub_title
from 	
	eth_wallet_detail ed,user_info u,eth_wallet e
where
	ed.address=e.address and e.user_uuid=u.uuid
		   <if test="searchValue != null and searchValue !='' ">
    		and u.name like concat('%',#{searchValue},'%')
    		or ed.value like concat('%',#{searchValue},'%')
    		or ed.title like concat('%',#{searchValue},'%')
    		or ed.created like concat('%',#{searchValue},'%')
    		or ed.remark like concat('%',#{searchValue},'%')
    		or ed.rest_balance like concat('%',#{searchValue},'%')
    		or ed.sub_title like concat('%',#{searchValue},'%')
       </if>
order by ed.created desc
limit #{offset}, #{limit};
</select>

<select id="countByTradeRecordBySearchValue" resultType="java.lang.Integer">
  select 
	count(*)
from 	
	eth_wallet_detail ed,user_info u,eth_wallet e
where
	ed.address=e.address and e.user_uuid=u.uuid
	<if test="searchValue != null and searchValue !='' ">
    		and u.name like concat('%',#{searchValue},'%')
    		or ed.value like concat('%',#{searchValue},'%')
    		or ed.title like concat('%',#{searchValue},'%')
    		or ed.created like concat('%',#{searchValue},'%')
    		or ed.remark like concat('%',#{searchValue},'%')
    		or ed.rest_balance like concat('%',#{searchValue},'%')
    		or ed.sub_title like concat('%',#{searchValue},'%')
       </if>
</select>

<resultMap id="walletTotalTradeRecordMap" type="com.cascv.oas.server.blockchain.wrapper.WalletTotalTradeRecordInfo">
    <result column="name" property="name"/>
	<result column="value" property="value"/>
</resultMap>
  
 <select id="selectAllInTotalTradeRecordBySearchValue" resultMap="walletTotalTradeRecordMap">
   select 
		u.name,SUM(ed.value) as value
from 
		eth_wallet e,eth_wallet_detail ed,user_info u
where
		ed.address=e.address and e.user_uuid=u.uuid and ed.in_or_out=1 and DATE_FORMAT(ed.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
		<if test="searchValue != null and searchValue !='' ">
    		and u.name like concat('%',#{searchValue},'%')
    		or ed.value like concat('%',#{searchValue},'%')
       </if>
group by u.name 
order by value desc
limit #{offset}, #{limit};
   </select>
   
         <select id="countByInTotalTradeRecordBySearchValue" resultType="java.lang.Integer">
   select 
		count(distinct ed.address)
from 
		eth_wallet e,eth_wallet_detail ed,user_info u
where
		ed.address=e.address and e.user_uuid=u.uuid and ed.in_or_out=1 and DATE_FORMAT(ed.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
		<if test="searchValue != null and searchValue !='' ">
    		and u.name like concat('%',#{searchValue},'%')
    		or ed.value like concat('%',#{searchValue},'%')
       </if>
       ;
   </select>
   
  <select id="selectAllOutTotalTradeRecordBySearchValue" resultMap="walletTotalTradeRecordMap">
   select 
		u.name,SUM(ed.value) as value
from 
		eth_wallet e,eth_wallet_detail ed,user_info u
where
		ed.address=e.address and e.user_uuid=u.uuid and ed.in_or_out=0 and DATE_FORMAT(ed.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
		<if test="searchValue != null and searchValue !='' ">
    		and u.name like concat('%',#{searchValue},'%')
    		or ed.value like concat('%',#{searchValue},'%')
       </if>
group by u.name 
order by value desc
limit #{offset}, #{limit};
   </select>
   
      <select id="countByOutTotalTradeRecordBySearchValue" resultType="java.lang.Integer">
   select 
		count(distinct ed.address)
from 
		eth_wallet e,eth_wallet_detail ed,user_info u
where
		ed.address=e.address and e.user_uuid=u.uuid and ed.in_or_out=0 and DATE_FORMAT(ed.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
        <if test="searchValue != null and searchValue !='' ">
    		and u.name like concat('%',#{searchValue},'%')
    		or ed.value like concat('%',#{searchValue},'%')
       </if>
       ;
   </select>
</mapper>