<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cascv.oas.server.exchange.mapper.ExchangeRateMapper">

  <resultMap id="exchangeRateMap" type="com.cascv.oas.server.exchange.model.ExchangeRateModel">
  	<id column="time" property="time" />
	<id column="currency" property="currency" />
	<result column="rate" property="rate" jdbcType="DECIMAL"/>
	<result column="comment" property="comment"/>
	<result column="created" property="created"/>
	<result column="updated" property="updated"/>
  </resultMap>
  
  <sql id="Base_Column_List">
	time,currency,rate,comment,created,updated
  </sql>
  
 
  <!-- insertSelective -->
  <insert id="insertSelective" parameterType="com.cascv.oas.server.exchange.model.ExchangeRateModel">
    insert into exchange_rate(
      	time,
    	currency,
    	rate,
    	<if test="comment!=null">
    	comment,
    	</if>
    	created,
    	updated
	)  values (
		#{time,jdbcType=VARCHAR},
		#{currency,jdbcType=INTEGER},
		#{rate,jdbcType=DECIMAL},
		<if test="comment!=null">
			#{comment,jdbcType=VARCHAR},
		</if>
		#{created,jdbcType=VARCHAR},
		#{updated,jdbcType=VARCHAR}
	)
  </insert>

  <update id="updateSelective" parameterType="com.cascv.oas.server.exchange.model.ExchangeRateModel">
  	update  exchange_rate
  	<trim prefix="set" suffixOverrides=",">
      <if test="comment!=null">
      	comment= #{comment},
      </if>
      <if test="rate != null">
      	rate = #{rate},
      </if>
    </trim>
    where time = #{time} and currency = #{currency}
  </update>

  <select id="selectOne" resultMap="exchangeRateMap">
  	select 
      <include refid="Base_Column_List" />
    from exchange_rate 
    where time = #{time} and currency = #{currency}
  </select>
  
  <select id="selectNear" resultMap="exchangeRateMap">
  	select 
      <include refid="Base_Column_List"/>
    from exchange_rate 
    where currency = #{currency} and STRCMP(time,#{time}) = -1
    order by time desc
    limit 1
  </select>
  
</mapper>