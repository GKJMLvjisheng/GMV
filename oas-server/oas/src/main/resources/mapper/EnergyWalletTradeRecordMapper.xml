<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cascv.oas.server.energy.mapper.EnergyWalletTradeRecordMapper">

  <resultMap id="EnergyWalletTradeRecordMap" type="com.cascv.oas.server.energy.vo.EnergyWalletTradeRecordInfo">
	<result column="name" property="name"/>
	<result column="in_or_out" property="inOrOut"/>
	<result column="point_change" property="pointChange"/>
	<result column="status" property="status"/>
	<result column="created" property="created"/>
	<result column="rest_point" property="restPoint"/>
  </resultMap>
<select id="selectAllTradeRecordBySearchValue" resultMap="EnergyWalletTradeRecordMap">
select 
	  u.name,etr.in_or_out,etr.point_change,etr.status,etr.created,etr.rest_point 
from 
	  point_trade_record etr left join user_info u on etr.user_uuid=u.uuid 
	   <if test="searchValue != null and searchValue != null ">
    	    where u.name like concat('%',#{searchValue},'%')
    		or etr.in_or_out like concat('%',#{searchValue},'%')
    		or etr.point_change like concat('%',#{searchValue},'%')
    		or etr.status like concat('%',#{searchValue},'%')
    		or etr.created like concat('%',#{searchValue},'%')
    		or etr.rest_point like concat('%',#{searchValue},'%')
       </if>
       
order by etr.created desc
limit #{offset}, #{limit};
</select>

 <select id="countByEnergyWalletTradeRecordBySearchValue" resultType="java.lang.Integer">
select 
	  count(*) 
from 
	 point_trade_record etr left join user_info u on etr.user_uuid=u.uuid 
	   <if test="searchValue != null and searchValue != null ">
    	    where u.name like concat('%',#{searchValue},'%')
    		or etr.in_or_out like concat('%',#{searchValue},'%')
    		or etr.point_change like concat('%',#{searchValue},'%')
    		or etr.status like concat('%',#{searchValue},'%')
    		or etr.created like concat('%',#{searchValue},'%')
    		or etr.rest_point like concat('%',#{searchValue},'%')
       </if>
       ;
</select>


<resultMap id="energyWalletBalanceRecordMap" type="com.cascv.oas.server.energy.vo.EnergyWalletBalanceRecordInfo">
    <result column="name" property="name"/>
	<result column="point" property="point"/>
	<result column="power" property="power"/>
</resultMap>
  
<select id="selectAllEnergyWalletBalanceRecordBySearchValue" resultMap="energyWalletBalanceRecordMap">
select 
	u.name,ew.point,ew.power
from 	
	energy_wallet ew left join user_info u on ew.user_uuid=u.uuid
	<if test="searchValue != null and searchValue !='' ">
    		where u.name like concat('%',#{searchValue},'%')
    		or ew.point like concat('%',#{searchValue},'%')
    		or ew.power like concat('%',#{searchValue},'%')
       </if>
order by ew.point desc
limit #{offset}, #{limit};
</select>

<select id="countByEnergyWalletBalanceRecordBySearchValue" resultType="java.lang.Integer">
select  
		count(*) 
from 
		energy_wallet ew left join user_info u on ew.user_uuid=u.uuid
	<if test="searchValue != null and searchValue !='' ">
    		where u.name like concat('%',#{searchValue},'%')
    		or ew.point like concat('%',#{searchValue},'%')
    		or ew.power like concat('%',#{searchValue},'%')
       </if>
       ;	
</select> 


<resultMap id="energyWalletPointRecordMap" type="com.cascv.oas.server.energy.vo.EnergyWalletPointRecordInfo">
    <result column="name" property="name"/>
	<result column="point" property="point"/>
</resultMap>

<select id="selectAllInTotalPointTradeRecordBySearchValue" resultMap="energyWalletPointRecordMap">
select 
	u.name,SUM(etr.point_change) as point
from 	
	point_trade_record etr left join user_info u on etr.in_or_out=1 and etr.user_uuid=u.uuid
where
    DATE_FORMAT(etr.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
    <if test="searchValue != null and searchValue !='' ">
    and u.name like concat('%',#{searchValue},'%')
    or etr.point_change like concat('%',#{searchValue},'%')
    </if>
group by u.name
order by point desc
limit #{offset}, #{limit};
</select>

<select id="countByInTotalPointTradeRecordBySearchValue" resultType="java.lang.Integer">
select 
	count(distinct etr.user_uuid)
from 	
	point_trade_record etr left join user_info u on etr.in_or_out=1 and etr.user_uuid=u.uuid
where
	DATE_FORMAT(etr.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
	 <if test="searchValue != null and searchValue !='' ">
    and u.name like concat('%',#{searchValue},'%')
    or etr.point_change like concat('%',#{searchValue},'%')
    </if>
    ;
</select> 
   
<select id="selectAllOutTotalPointTradeRecordBySearchValue" resultMap="energyWalletPointRecordMap">
select 
	u.name,SUM(etr.point_change) as point
from 	
	point_trade_record etr left join user_info u on etr.in_or_out=0 and etr.user_uuid=u.uuid
where
	DATE_FORMAT(etr.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
   <if test="searchValue != null and searchValue !='' ">
    and u.name like concat('%',#{searchValue},'%')
    or etr.point_change like concat('%',#{searchValue},'%')
    </if>
group by u.name
order by point desc
limit #{offset}, #{limit};
</select>

<select id="countByOutTotalPointTradeRecordBySearchValue" resultType="java.lang.Integer">
select 
	count(distinct etr.user_uuid)
from 	
	point_trade_record etr left join user_info u on etr.in_or_out=0 and etr.user_uuid=u.uuid
where
	DATE_FORMAT(etr.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
    <if test="searchValue != null and searchValue !='' ">
    and u.name like concat('%',#{searchValue},'%')
    or etr.point_change like concat('%',#{searchValue},'%')
    </if>
    ;
</select>
   
</mapper>