<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cascv.oas.server.energy.mapper.EnergyWalletTradeRecordMapper">

  <resultMap id="EnergyWalletTradeRecordMap" type="com.cascv.oas.server.energy.vo.EnergyWalletTradeRecordInfo">
	<result column="name" property="name"/>
	<result column="in_or_out" property="inOrOut"/>
	<result column="point_change" property="pointChange"/>
	<result column="power_change" property="powerChange"/>
	<result column="status" property="status"/>
	<result column="time_created" property="timeCreated"/>
  </resultMap>
  <select id="selectAllTradeRecord" resultMap="EnergyWalletTradeRecordMap">
select 
	  u.name,etr.in_or_out,etr.point_change,etr.power_change,etr.status,etr.time_created 
from 
	  energy_trade_record etr,user_info u
where
	  etr.user_uuid=u.uuid
order by etr.time_created desc;
</select>

<resultMap id="energyWalletBalanceRecordMap" type="com.cascv.oas.server.energy.vo.EnergyWalletBalanceRecordInfo">
    <result column="name" property="name"/>
	<result column="point" property="point"/>
	<result column="power" property="power"/>
</resultMap>
  
<select id="selectAllEnergyWalletBalanceRecord" resultMap="energyWalletBalanceRecordMap">
select 
	u.name,ew.point,ew.power
from 	
	energy_wallet ew,user_info u
where
	ew.user_uuid=u.uuid and DATE_FORMAT(ew.created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
order by ew.point desc
</select> 

<resultMap id="energyWalletPointRecordMap" type="com.cascv.oas.server.energy.vo.EnergyWalletPointRecordInfo">
    <result column="name" property="name"/>
	<result column="point" property="point"/>
</resultMap>

<select id="selectAllInTotalPointTradeRecord" resultMap="energyWalletPointRecordMap">
select 
	u.name,SUM(etr.point_change) as point
from 	
	energy_trade_record etr,user_info u
where
	etr.user_uuid=u.uuid and etr.in_or_out=1 and DATE_FORMAT(etr.time_created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
group by u.name
order by point desc
</select>   
   
<select id="selectAllOutTotalPointTradeRecord" resultMap="energyWalletPointRecordMap">
select 
	u.name,SUM(etr.point_change) as point
from 	
	energy_trade_record etr,user_info u
where
	etr.user_uuid=u.uuid and etr.in_or_out=0 and DATE_FORMAT(etr.time_created,"%Y-%m-%d") BETWEEN #{startTime} and #{endTime}
group by u.name
order by point desc
</select>
   
</mapper>